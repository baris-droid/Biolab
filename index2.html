<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Usta Dönerci Tycoon - Fullscreen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;800&display=swap');
        
        /* Mobil Tarayıcı Kaydırma ve Seçim Engelleme */
        body { 
            font-family: 'Rubik', sans-serif; 
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }
        
        .pattern-cubes { background-image: url('https://www.transparenttextures.com/patterns/cubes.png'); }
        
        /* Animasyonlar */
        @keyframes pop { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .animate-pop { animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
        .animate-float { animation: float 3s ease-in-out infinite; }
        
        /* Scrollbar Gizleme */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Buton Efektleri */
        .ing-btn:active { transform: translateY(4px); box-shadow: none; }
        .ing-btn { transition: all 0.1s; box-shadow: 0 4px 0 rgba(0,0,0,0.1); }

        /* --- KRİTİK MOBİL DÜZELTMESİ --- */
        /* iOS ve Android alt bar güvenli alanı - Biraz daha artırıldı */
        .pb-safe-area {
            padding-bottom: calc(env(safe-area-inset-bottom) + 30px); 
        }
        /* Tam ekranda ekranın tamamen dolmasını sağlar */
        html, body {
            height: 100%;
            height: 100dvh; /* Dynamic Viewport Height */
        }
    </style>
</head>
<body class="bg-slate-100 h-full overflow-hidden flex flex-col text-gray-800">

    <!-- GİRİŞ EKRANI -->
    <div id="menu-screen" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-amber-50 p-4">
        <div class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-md w-full border-b-8 border-orange-500 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-orange-500"></div>
            <div class="flex justify-center mb-6">
                 <svg width="100" height="100" viewBox="0 0 100 100" class="drop-shadow-lg animate-float">
                    <path d="M20 60 Q50 90 80 60 L80 30 Q50 0 20 30 Z" fill="#B91C1C" />
                    <path d="M15 65 Q50 100 85 65" stroke="#F59E0B" stroke-width="5" fill="none" stroke-linecap="round"/>
                    <rect x="45" y="10" width="10" height="80" fill="#78350F" rx="5" />
                 </svg>
            </div>
            <h1 class="text-4xl font-black text-gray-800 mb-2 tracking-tighter">USTA DÖNERCİ</h1>
            <p class="text-gray-500 font-medium mb-8">"Soğanı bas mikrop kırılsın!"</p>
            <button onclick="startGame()" class="w-full bg-green-500 active:bg-green-600 text-white text-xl font-black py-4 rounded-2xl shadow-[0_6px_0_#15803d] active:shadow-none active:translate-y-[6px] transition-all flex items-center justify-center gap-3">
                <i data-lucide="play" class="fill-current"></i> DÜKKANI AÇ
            </button>
            <p class="text-xs text-gray-400 mt-4">Oyun tam ekran açılacaktır.</p>
        </div>
    </div>

    <!-- OYUN EKRANI -->
    
    <!-- ÜST PANEL -->
    <div class="flex-none bg-white shadow-md z-20 p-2 border-b border-gray-200 pt-safe-top">
        <div class="flex justify-between items-center mb-2 px-1">
            <div class="flex gap-2">
                <div class="flex items-center gap-2 bg-green-100 text-green-800 px-4 py-2 rounded-xl font-black shadow-inner border border-green-200">
                    <span class="text-lg">₺</span> <span id="money-display" class="text-xl">0</span>
                </div>
                <button onclick="toggleShop(true)" class="flex items-center gap-2 bg-violet-100 text-violet-700 px-3 py-2 rounded-xl font-bold border border-violet-200 hover:bg-violet-200 transition-colors">
                    <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                </button>
            </div>
            <div id="timer-container" class="flex items-center gap-2 px-4 py-2 rounded-xl font-black bg-gray-100 text-gray-600 border border-gray-200">
                <i data-lucide="clock" class="w-5 h-5"></i> <span id="time-display" class="text-xl">0</span>
                <div id="tea-btn-container"></div>
            </div>
        </div>
        <div id="order-card" class="hidden bg-orange-50 border-l-4 border-orange-500 rounded-r-xl p-3 shadow-sm relative transition-all mx-1"></div>
    </div>

    <!-- ORTA OYUN ALANI -->
    <div class="flex-1 relative flex overflow-hidden bg-slate-200">
        <!-- SOL: DÖNER OCAĞI -->
        <div class="w-[140px] sm:w-[180px] bg-gray-800 flex flex-col items-center justify-end relative border-r-4 border-gray-700 shadow-2xl overflow-hidden">
            <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-gray-700 to-gray-900 opacity-50"></div>
            
            <!-- Döner ve Şiş -->
            <div id="doner-container" class="absolute top-0 w-full flex justify-center h-[70%] transition-transform duration-100">
                <div class="w-3 bg-gray-400 h-full absolute z-0"></div>
                <div id="doner-meat" class="relative z-10 w-24 sm:w-32 bg-[#6b2818] rounded-xl flex flex-col items-center overflow-hidden border-x-2 border-[#4a190f] origin-top transition-all" style="height: 100%;">
                    <svg width="100%" height="100%" class="absolute inset-0 opacity-40"><pattern id="meatPattern" x="0" y="0" width="20" height="10" patternUnits="userSpaceOnUse"><path d="M0 5 Q10 0 20 5" stroke="#3f1008" stroke-width="2" fill="none"/></pattern><rect width="100%" height="100%" fill="url(#meatPattern)"/></svg>
                    <div class="absolute left-2 w-2 h-full bg-white opacity-10 blur-sm"></div>
                </div>
            </div>
            
            <!-- Ateş Efekti -->
            <div class="w-full h-32 bg-gradient-to-t from-orange-600 via-red-600 to-transparent opacity-80 animate-pulse absolute bottom-[80px] pointer-events-none z-0 blur-sm"></div>
            
            <!-- KES BUTONU (Biraz yukarı taşındı) -->
            <button onpointerdown="cutMeat()" class="absolute bottom-8 w-[90%] bg-gradient-to-b from-red-500 to-red-700 active:from-red-700 active:to-red-800 text-white font-black text-lg py-4 rounded-xl shadow-[0_4px_0_#7f1d1d] active:shadow-none active:translate-y-[4px] transition-all z-20 flex items-center justify-center gap-2 border-2 border-red-800">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 21V8a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v13"/><path d="M12 10v4"/></svg> KES
            </button>
            
            <!-- Yenileme -->
            <button id="refresh-btn" onclick="refreshMeat()" class="hidden absolute top-2 right-2 bg-yellow-400 text-yellow-900 p-2 rounded-full shadow-lg animate-bounce z-30 border-2 border-yellow-600">
                <i data-lucide="rotate-ccw" class="w-5 h-5"></i><span class="absolute -bottom-4 left-1/2 -translate-x-1/2 bg-black text-white text-[10px] px-1 rounded">50₺</span>
            </button>
        </div>

        <!-- SAĞ: TEZGAH -->
        <div class="flex-1 pattern-cubes bg-[#e5e7eb] p-4 relative flex flex-col items-center justify-center">
            <!-- Stok Paneli -->
            <div class="absolute top-3 right-3 bg-white px-4 py-2 rounded-xl shadow-lg border-b-4 border-gray-200 flex flex-col items-center z-10">
                <span class="text-[10px] uppercase font-bold text-gray-400 tracking-wider mb-1">Kesilmiş Et</span>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-2xl font-black text-gray-800"><span id="prepared-meat-display">0</span><span class="text-gray-300 text-lg">/</span><span id="storage-limit-display" class="text-lg text-gray-400">10</span></span>
                </div>
            </div>
            
            <!-- Hazırlama Alanı -->
            <div id="bench-area" class="relative w-full h-full max-h-[300px] flex items-center justify-center transition-all pb-10">
                <div class="w-64 h-40 border-4 border-dashed border-gray-300 rounded-3xl flex flex-col items-center justify-center text-gray-400 bg-gray-50/50">
                    <i data-lucide="utensils" class="w-8 h-8 mb-2 opacity-50"></i><span class="font-bold">TEZGAH BOŞ</span><span class="text-xs">Aşağıdan Ekmek Seç</span>
                </div>
            </div>
            
            <!-- Aksiyon Butonları -->
            <div class="absolute bottom-4 w-full px-4 flex justify-between items-center gap-3 max-w-md">
                <button onclick="trashBench()" class="bg-white hover:bg-red-50 text-red-500 p-4 rounded-2xl shadow-[0_4px_0_#e5e7eb] active:shadow-none active:translate-y-[4px] transition-all border border-gray-100">
                    <i data-lucide="trash-2" class="w-6 h-6"></i>
                </button>
                <button id="serve-btn" onclick="serveOrder()" disabled class="flex-1 bg-emerald-500 hover:bg-emerald-600 disabled:opacity-50 disabled:grayscale text-white py-4 rounded-2xl font-black text-xl shadow-[0_6px_0_#047857] active:shadow-none active:translate-y-[6px] transition-all flex items-center justify-center gap-2 border-b-2 border-emerald-700">
                    SERVİS ET <i data-lucide="check" class="w-6 h-6 stroke-[3]"></i>
                </button>
            </div>
            
            <!-- Feedback Popup -->
            <div id="feedback-popup" class="hidden absolute top-10 left-1/2 -translate-x-1/2 px-6 py-3 rounded-2xl shadow-2xl text-white font-black text-sm whitespace-nowrap z-50 border-2 border-white/20 backdrop-blur-md"></div>
        </div>
    </div>

    <!-- ALT: MALZEME PALETİ -->
    <!-- pb-safe-area sınıfı ile alttan ekstra boşluk bırakıldı -->
    <div class="flex-none bg-white p-3 border-t border-gray-200 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] z-30 overflow-x-auto no-scrollbar pb-safe-area">
        <div id="ingredients-container" class="flex gap-3 min-w-max px-1 h-[100px] items-center"></div>
    </div>

    <!-- MARKET MODAL -->
    <div id="shop-modal" class="hidden fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-4 animate-in fade-in duration-200 pb-safe-area">
        <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl max-h-[80dvh] flex flex-col overflow-hidden">
            <div class="p-5 border-b bg-gray-50 flex justify-between items-center">
                <h2 class="text-2xl font-black text-gray-800 flex items-center gap-2"><span class="bg-violet-100 text-violet-600 p-2 rounded-lg"><i data-lucide="shopping-bag"></i></span> MARKET</h2>
                <button onclick="toggleShop(false)" class="p-2 bg-gray-200 rounded-full hover:bg-gray-300 transition-colors"><i data-lucide="x"></i></button>
            </div>
            <div id="shop-items-container" class="p-4 overflow-y-auto flex-1 bg-gray-50 space-y-3 pb-8"></div>
        </div>
    </div>

    <script>
        const SVGS = {
            bread: `<svg viewBox="0 0 100 60" class="w-full h-full drop-shadow-md"><path d="M10 30 Q10 5 50 5 Q90 5 90 30 Q90 55 50 55 Q10 55 10 30" fill="#F59E0B" stroke="#D97706" stroke-width="2"/><path d="M20 20 Q50 15 80 20" fill="none" stroke="#FCD34D" stroke-width="3" stroke-linecap="round"/></svg>`,
            lavash: `<svg viewBox="0 0 100 60" class="w-full h-full drop-shadow-md"><rect x="10" y="15" width="80" height="30" rx="5" fill="#FEF3C7" stroke="#D97706" stroke-width="1"/><path d="M15 15 Q20 25 15 45" fill="none" stroke="#D97706" stroke-width="1" opacity="0.5"/><path d="M85 15 Q80 25 85 45" fill="none" stroke="#D97706" stroke-width="1" opacity="0.5"/></svg>`,
            meat: `<svg viewBox="0 0 60 60" class="w-full h-full drop-shadow-sm"><path d="M10 20 Q30 5 50 20 Q55 35 45 50 Q25 55 10 45 Q0 30 10 20" fill="#7F1D1D" stroke="#450a0a" stroke-width="1"/><path d="M15 25 Q30 15 45 25" fill="none" stroke="#991b1b" stroke-width="2"/></svg>`,
            tomato: `<svg viewBox="0 0 60 60" class="w-full h-full drop-shadow-sm"><circle cx="30" cy="30" r="22" fill="#EF4444" stroke="#991B1B" stroke-width="1"/><circle cx="30" cy="30" r="15" fill="#DC2626"/><path d="M30 10 L35 20 L40 15" fill="none" stroke="#166534" stroke-width="2" stroke-linecap="round"/></svg>`,
            onion: `<svg viewBox="0 0 60 60" class="w-full h-full drop-shadow-sm"><circle cx="30" cy="30" r="22" fill="#E9D5FF" stroke="#A855F7" stroke-width="2"/><circle cx="30" cy="30" r="15" fill="none" stroke="#C084FC" stroke-width="2"/><circle cx="30" cy="30" r="8" fill="none" stroke="#C084FC" stroke-width="2"/></svg>`,
            lettuce: `<svg viewBox="0 0 60 60" class="w-full h-full drop-shadow-sm"><path d="M10 30 Q15 10 30 10 Q45 10 50 30 Q55 50 30 50 Q5 50 10 30" fill="#22C55E" stroke="#15803d" stroke-width="1"/><path d="M20 25 Q30 35 40 20" fill="none" stroke="#86EFAC" stroke-width="2"/></svg>`,
            fries: `<svg viewBox="0 0 60 60" class="w-full h-full drop-shadow-sm"><rect x="15" y="15" width="6" height="30" fill="#FACC15" rx="2"/><rect x="25" y="10" width="6" height="35" fill="#EAB308" rx="2"/><rect x="35" y="18" width="6" height="25" fill="#FACC15" rx="2"/></svg>`,
            sauce: `<svg viewBox="0 0 60 60" class="w-full h-full drop-shadow-sm"><path d="M30 5 Q50 30 50 45 Q50 55 30 55 Q10 55 10 45 Q10 30 30 5" fill="#DC2626" stroke="#991b1b" stroke-width="1"/><path d="M35 15 Q40 25 35 35" fill="none" stroke="#FECACA" stroke-width="2" opacity="0.5"/></svg>`
        };

        const INGREDIENTS = {
            bread: { id: 'bread', name: 'Ekmek', svg: SVGS.bread, type: 'base', border: 'border-amber-200' },
            lavash: { id: 'lavash', name: 'Lavaş', svg: SVGS.lavash, type: 'base', border: 'border-yellow-200' },
            meat: { id: 'meat', name: 'Et Döner', svg: SVGS.meat, type: 'filling', border: 'border-red-200' },
            tomato: { id: 'tomato', name: 'Domates', svg: SVGS.tomato, type: 'filling', border: 'border-red-200' },
            onion: { id: 'onion', name: 'Soğan', svg: SVGS.onion, type: 'filling', border: 'border-purple-200' },
            lettuce: { id: 'lettuce', name: 'Marul', svg: SVGS.lettuce, type: 'filling', border: 'border-green-200' },
            fries: { id: 'fries', name: 'Patates', svg: SVGS.fries, type: 'filling', border: 'border-yellow-200' },
            sauce: { id: 'sauce', name: 'Özel Sos', svg: SVGS.sauce, type: 'sauce', border: 'border-orange-200' },
        };

        const CUSTOMER_TYPES = [
            { 
                name: 'Öğrenci', 
                phrases: [
                    'Abi şunun içini ağlat be! (Bol Sos)', 
                    'KYK yattı, gömüyoruz.', 
                    'Usta ekmeği yağa ban, ölmeyiz.',
                    'Abi etleri cımbızla mı koydun?'
                ], 
                impatience: 1.2 
            },
            { 
                name: 'Esnaf Abi', 
                phrases: [
                    'Müdür, soğanı bas mikrop kırılsın.', 
                    'Yandaki dükkana paket, acele et.', 
                    'Çayı koydum, döneri bekliyorum.',
                    'Hayırlı işler, eti kurutma ha!'
                ], 
                impatience: 1.0 
            },
            { 
                name: 'Plazacı Merve', 
                phrases: [
                    'Toplantım var, soğan ASLA!', 
                    'Multinet geçiyor mu usta?', 
                    'Wrap şeklinde alabilir miyim?',
                    'Az yağlı olsun, diyetteyim.'
                ], 
                impatience: 1.6 
            },
            { 
                name: 'Semt Oturuşu', 
                phrases: [
                    'Bize şöyle atom yap, kendimize gelelim.', 
                    'Acıyı bas, yarına çıkmayalım.', 
                    'Usta ateş seni çağırıyor!',
                    'Yapıştır gelsin aslan parçası.'
                ], 
                impatience: 1.1 
            },
            { 
                name: 'Sporcu', 
                phrases: [
                    'Ekmeğin içini al, karbo basma.', 
                    'Sadece protein usta, bas eti.', 
                    'Antrenman var, enerjisiz kaldık.',
                    'Yağsız tarafından kesebilir misin?'
                ], 
                impatience: 1.3 
            }
        ];

        const UPGRADES = {
            knife: { id: 'knife', name: 'Altın Bıçak', icon: 'zap', desc: 'Tek vuruşta daha çok et kes.', baseCost: 150, multiplier: 1.5, maxLevel: 5 },
            chair: { id: 'chair', name: 'Yumuşak Koltuk', icon: 'armchair', desc: 'Müşteriler daha çok bekler.', baseCost: 200, multiplier: 1.6, maxLevel: 5 },
            sign: { id: 'sign', name: 'Neon Tabela', icon: 'dollar-sign', desc: 'Satış fiyatlarını artırır.', baseCost: 300, multiplier: 1.8, maxLevel: 5 },
            storage: { id: 'storage', name: 'Geniş Tezgah', icon: 'arrow-up-circle', desc: 'Daha fazla et stokla.', baseCost: 100, multiplier: 1.4, maxLevel: 5 },
        };

        let state = {
            money: 0, score: 0, level: 1, isPlaying: false, shopOpen: false,
            currentOrder: null, timeLeft: 0, timerId: null,
            meatCooked: 100, preparedMeat: 0,
            benchBase: null, benchItems: [],
            upgrades: { knife: 0, chair: 0, sign: 0, storage: 0 }
        };

        function getUpgradeValue(type, level) {
            if (type === 'knife') return 1 + (level * 1);
            if (type === 'chair') return 1 + (level * 0.10);
            if (type === 'sign') return 1 + (level * 0.15);
            if (type === 'storage') return 10 + (level * 5);
            return 0;
        }

        function generateOrder() {
            const isLavash = Math.random() > 0.5;
            const base = isLavash ? INGREDIENTS.lavash : INGREDIENTS.bread;
            const items = [INGREDIENTS.meat];
            if (Math.random() > 0.3) items.push(INGREDIENTS.tomato);
            if (Math.random() > 0.3) items.push(INGREDIENTS.onion);
            if (Math.random() > 0.3) items.push(INGREDIENTS.lettuce);
            if (Math.random() > 0.5) items.push(INGREDIENTS.fries);
            if (Math.random() > 0.4) items.push(INGREDIENTS.sauce);

            const type = CUSTOMER_TYPES[Math.floor(Math.random() * CUSTOMER_TYPES.length)];
            const baseTime = 20;
            const timeBonus = getUpgradeValue('chair', state.upgrades.chair);
            const timeLimit = Math.max(10, (baseTime - (state.level * 0.5)) * timeBonus);
            const priceMult = getUpgradeValue('sign', state.upgrades.sign);
            const basePrice = 50 + (items.length * 10);

            return {
                id: Date.now(), base, items, customer: type,
                phrase: type.phrases[Math.floor(Math.random() * type.phrases.length)],
                timeLimit: Math.floor(timeLimit), price: Math.floor(basePrice * priceMult)
            };
        }

        function checkOrder() {
            if (!state.benchBase || state.benchBase.id !== state.currentOrder.base.id) return false;
            const buildIds = state.benchItems.map(i => i.id).sort();
            const orderIds = state.currentOrder.items.map(i => i.id).sort();
            if (buildIds.length !== orderIds.length) return false;
            for (let i = 0; i < buildIds.length; i++) {
                if (buildIds[i] !== orderIds[i]) return false;
            }
            return true;
        }

        // --- FULLSCREEN FONKSİYONU ---
        function openFullscreen() {
            var elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(err => console.log("Fullscreen engellendi:", err));
            } else if (elem.webkitRequestFullscreen) { /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE11 */
                elem.msRequestFullscreen();
            }
        }

        function startGame() {
            // Oyunu başlatırken Tam Ekran yap
            openFullscreen();
            
            document.getElementById('menu-screen').style.display = 'none';
            state.isPlaying = true; state.money = 0; state.level = 1;
            renderIngredients(); nextCustomer(); updateUI();
        }

        function nextCustomer() {
            state.currentOrder = generateOrder();
            state.timeLeft = state.currentOrder.timeLimit;
            state.benchBase = null; state.benchItems = [];
            if (state.timerId) clearInterval(state.timerId);
            state.timerId = setInterval(() => {
                if (!state.shopOpen && state.isPlaying) {
                    state.timeLeft--; updateTimerUI();
                    if (state.timeLeft <= 0) handleOrderResult(false, "Müşteri Kaçtı!");
                }
            }, 1000);
            renderBench(); renderOrder();
        }

        function handleOrderResult(success, msg) {
            clearInterval(state.timerId);
            if (success) {
                state.money += state.currentOrder.price; state.level += 0.1;
                showFeedback('success', `+${state.currentOrder.price}₺ ${msg}`);
                setTimeout(nextCustomer, 1000);
            } else {
                state.money = Math.max(0, state.money - 20);
                showFeedback('error', msg);
                setTimeout(nextCustomer, 1500);
            }
            updateUI();
        }

        function cutMeat() {
            if (state.meatCooked > 0) {
                const limit = getUpgradeValue('storage', state.upgrades.storage);
                const amount = getUpgradeValue('knife', state.upgrades.knife);
                state.meatCooked = Math.max(0, state.meatCooked - 5);
                state.preparedMeat = Math.min(limit, state.preparedMeat + amount);
                const doner = document.getElementById('doner-meat');
                doner.style.transform = 'scaleX(0.9)'; setTimeout(() => doner.style.transform = 'scaleX(1)', 100);
                updateUI();
            } else { showFeedback('error', 'Et Bitti!'); }
        }

        function refreshMeat() {
            if (state.money >= 50) {
                state.money -= 50; state.meatCooked = 100;
                showFeedback('success', 'Taze Döner!'); updateUI();
            } else { showFeedback('error', 'Para Yok!'); }
        }

        function addToBench(ingId) {
            const ing = Object.values(INGREDIENTS).find(i => i.id === ingId);
            if (ing.type === 'base') {
                if (state.benchBase) { showFeedback('error', 'Zaten Ekmek Var'); return; }
                state.benchBase = ing;
            } else {
                if (!state.benchBase) { showFeedback('error', 'Önce Ekmek!'); return; }
                if (ing.id === 'meat') {
                    if (state.preparedMeat > 0) {
                        state.preparedMeat--; state.benchItems.push(ing);
                    } else { showFeedback('error', 'Et Kesmelisin!'); return; }
                } else { state.benchItems.push(ing); }
            }
            renderBench(); updateUI();
        }

        function trashBench() { state.benchBase = null; state.benchItems = []; renderBench(); updateUI(); }
        function serveOrder() { if (!state.currentOrder) return; checkOrder() ? handleOrderResult(true, "Afiyet Olsun!") : handleOrderResult(false, "Yanlış Sipariş!"); }
        function buyTea() { if (state.money >= 20) { state.money -= 20; state.timeLeft += 15; showFeedback('success', 'Çay İkram Edildi'); updateTimerUI(); updateUI(); } else { showFeedback('error', 'Para Yok'); } }
        function toggleShop(isOpen) { state.shopOpen = isOpen; const modal = document.getElementById('shop-modal'); if (isOpen) { renderShopItems(); modal.classList.remove('hidden'); } else { modal.classList.add('hidden'); } }
        
        function buyUpgrade(type) {
            const upg = UPGRADES[type]; const level = state.upgrades[type];
            const cost = getUpgradeCost(upg.baseCost, upg.multiplier, level);
            if (level >= upg.maxLevel) return;
            if (state.money >= cost) {
                state.money -= cost; state.upgrades[type]++;
                showFeedback('success', 'Geliştirildi!'); renderShopItems(); updateUI();
            } else { showFeedback('error', 'Para Yok'); }
        }

        function showFeedback(type, msg) {
            const el = document.getElementById('feedback-popup');
            el.innerHTML = type === 'success' ? `<span class="flex items-center gap-2"><i data-lucide="check-circle"></i> ${msg}</span>` : `<span class="flex items-center gap-2"><i data-lucide="x-circle"></i> ${msg}</span>`;
            el.className = `absolute top-20 left-1/2 -translate-x-1/2 px-6 py-3 rounded-2xl shadow-2xl text-white font-black text-lg whitespace-nowrap z-50 animate-pop ${type === 'success' ? 'bg-emerald-500' : 'bg-rose-500'}`;
            el.classList.remove('hidden'); lucide.createIcons(); setTimeout(() => el.classList.add('hidden'), 1500);
        }

        function updateUI() {
            document.getElementById('money-display').textContent = Math.floor(state.money);
            document.getElementById('prepared-meat-display').textContent = state.preparedMeat;
            document.getElementById('storage-limit-display').textContent = getUpgradeValue('storage', state.upgrades.storage);
            const meatHeight = Math.max(20, state.meatCooked);
            document.getElementById('doner-meat').style.height = `${meatHeight}%`;
            const refreshBtn = document.getElementById('refresh-btn');
            state.meatCooked < 20 ? refreshBtn.classList.remove('hidden') : refreshBtn.classList.add('hidden');
            document.getElementById('serve-btn').disabled = !state.benchBase;
            const badge = document.getElementById('meat-badge'); if(badge) badge.textContent = state.preparedMeat;
        }

        function updateTimerUI() {
            document.getElementById('time-display').textContent = state.timeLeft;
            const container = document.getElementById('timer-container');
            const teaBtn = document.getElementById('tea-btn-container');
            if (state.timeLeft < 10) container.classList.add('text-red-600', 'bg-red-50', 'border-red-200', 'animate-pulse');
            else container.classList.remove('text-red-600', 'bg-red-50', 'border-red-200', 'animate-pulse');
            if (state.timeLeft < 15 && state.currentOrder) {
                teaBtn.innerHTML = `<button onclick="buyTea()" class="bg-amber-600 text-white text-xs px-2 py-1 rounded-lg shadow hover:bg-amber-700 flex items-center gap-1 animate-bounce font-bold"><i data-lucide="coffee" class="w-3 h-3"></i> -20₺</button>`; lucide.createIcons();
            } else { teaBtn.innerHTML = ''; }
        }

        function renderBench() {
            const area = document.getElementById('bench-area');
            if (!state.benchBase) { area.innerHTML = `<div class="w-64 h-40 border-4 border-dashed border-gray-300 rounded-3xl flex flex-col items-center justify-center text-gray-400 bg-gray-50/50"><i data-lucide="utensils" class="w-8 h-8 mb-2 opacity-50"></i><span class="font-bold">TEZGAH BOŞ</span><span class="text-xs">Aşağıdan Ekmek Seç</span></div>`; lucide.createIcons(); return; }
            const isLavash = state.benchBase.id === 'lavash';
            const baseClass = isLavash ? 'w-32 h-[240px] rounded-full flex-col' : 'w-[280px] h-[140px] rounded-[3rem] flex-row';
            let contentHTML = state.benchItems.map((item, idx) => `<div class="relative w-12 h-12 -ml-4 hover:z-10 hover:scale-110 transition-transform drop-shadow-md" style="z-index:${idx}; margin-top: ${isLavash ? '-20px' : '0'}; margin-left: ${isLavash ? '0' : '-20px'}">${item.svg}</div>`).join('');
            area.innerHTML = `<div class="relative ${baseClass} bg-[#f3f4f6] shadow-2xl border-4 border-white ring-4 ring-black/5 flex items-center justify-center animate-pop overflow-visible p-4"><div class="absolute inset-0 ${isLavash ? 'bg-yellow-100 border-2 border-yellow-300 rounded-full' : 'bg-amber-200 border-4 border-amber-400 rounded-[3rem]'}" style="z-index: 0;"></div><div class="relative z-10 flex ${isLavash ? 'flex-col' : 'flex-row'} items-center justify-center flex-wrap gap-1">${contentHTML}</div></div>`;
        }

        function renderOrder() {
            const card = document.getElementById('order-card');
            if (!state.currentOrder) { card.classList.add('hidden'); return; }
            card.classList.remove('hidden');
            const itemsHtml = state.currentOrder.items.map(i => `<div class="w-6 h-6 rounded-full bg-white shadow border border-gray-200 p-0.5" title="${i.name}">${i.svg}</div>`).join('');
            card.innerHTML = `<div class="flex justify-between items-start"><div><div class="flex items-center gap-2 mb-1"><span class="font-black text-gray-800 text-sm">${state.currentOrder.customer.name}</span><span class="text-xs text-gray-500 italic">"${state.currentOrder.phrase}"</span></div><div class="flex items-center gap-1 bg-white/50 p-1 rounded-lg"><div class="w-8 h-8 rounded bg-white shadow border border-gray-200 p-1">${state.currentOrder.base.svg}</div><span class="text-gray-400 text-xs font-bold">+</span>${itemsHtml}</div></div><div class="bg-emerald-100 text-emerald-700 px-2 py-1 rounded-lg font-black border border-emerald-200 text-sm">${state.currentOrder.price}₺</div></div>`;
        }

        function renderIngredients() {
            const container = document.getElementById('ingredients-container');
            let html = `<div class="flex gap-2 pr-4 border-r-2 border-gray-100 mr-2 items-center">`;
            [INGREDIENTS.bread, INGREDIENTS.lavash].forEach(i => {
                html += `<button onclick="addToBench('${i.id}')" class="ing-btn relative w-20 h-20 bg-white rounded-2xl border-b-4 ${i.border} flex flex-col items-center justify-center p-2 hover:bg-gray-50"><div class="w-12 h-8 mb-1">${i.svg}</div><span class="text-[10px] font-bold text-gray-500 uppercase">${i.name}</span></button>`;
            });
            html += `</div>`;
            Object.values(INGREDIENTS).forEach(i => {
                if (i.type === 'base') return;
                const isMeat = i.id === 'meat';
                html += `<button onclick="addToBench('${i.id}')" class="ing-btn relative w-16 h-16 bg-white rounded-xl border-b-4 ${i.border} flex flex-col items-center justify-center p-1 hover:bg-gray-50"><div class="w-8 h-8 mb-1">${i.svg}</div><span class="text-[9px] font-bold text-gray-500 leading-none">${i.name}</span>${isMeat ? `<div id="meat-badge" class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center shadow border-2 border-white">${state.preparedMeat}</div>` : ''}</button>`;
            });
            container.innerHTML = html;
        }

        function renderShopItems() {
            const container = document.getElementById('shop-items-container');
            let html = `<div class="bg-violet-100 p-4 rounded-2xl flex justify-between items-center mb-2 border border-violet-200"><span class="font-bold text-violet-800">Bakiye</span><span class="font-black text-2xl text-violet-700">${Math.floor(state.money)}₺</span></div>`;
            for (const [key, upg] of Object.entries(UPGRADES)) {
                const lvl = state.upgrades[key]; const cost = getUpgradeCost(upg.baseCost, upg.multiplier, lvl);
                const isMax = lvl >= upg.maxLevel; const canBuy = state.money >= cost && !isMax;
                html += `<div class="bg-white p-3 rounded-2xl border border-gray-100 shadow-sm flex items-center gap-3"><div class="w-12 h-12 rounded-xl bg-gray-100 flex items-center justify-center text-gray-500"><i data-lucide="${upg.icon}"></i></div><div class="flex-1"><div class="flex justify-between items-center"><h3 class="font-bold text-gray-800">${upg.name}</h3><div class="flex gap-0.5">${[...Array(5)].map((_,i) => `<div class="w-1.5 h-4 rounded-full ${i < lvl ? 'bg-green-500' : 'bg-gray-200'}"></div>`).join('')}</div></div><p class="text-xs text-gray-500">${upg.desc}</p></div><button onclick="buyUpgrade('${key}')" disabled="${!canBuy}" class="px-4 py-2 rounded-xl font-bold text-sm transition-all ${canBuy ? 'bg-green-500 text-white shadow-[0_3px_0_#15803d] active:translate-y-[3px] active:shadow-none' : 'bg-gray-100 text-gray-400'}">${isMax ? 'MAX' : cost + '₺'}</button></div>`;
            }
            container.innerHTML = html; lucide.createIcons();
        }

        lucide.createIcons();
    </script>
</body>
</html>


